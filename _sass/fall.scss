:root{
  --char-pop-max-delay: 120;
  --char-pop-duration: 220;
  --char-fall-duration: 1700;
  --char-rise-duration: 900;
}

/* performance: trasformazioni GPU */
.fall-char{
  display: inline-block;
  transform: translate3d(0,0,0);
  will-change: transform, opacity;
  backface-visibility: hidden;
}

/* opzionale: blocco overflow mentre cade */
.falling-mode #gravity-zone{
  overflow: hidden;
}

/* 1) vibrazione iniziale più pronunciata */
.char-pop{
  animation: charPop calc(var(--char-pop-duration) * 1ms) cubic-bezier(.2,.9,.2,1.2) both;
}

@keyframes charPop{
  0%   { transform: translate3d(0,0,0) rotate(0deg); }
  10%  { transform: translate3d(calc(-1 * var(--pop-shake)), 0, 0) rotate(calc(-0.6 * var(--pop-rot))); }
  20%  { transform: translate3d(var(--pop-shake), -1px, 0) rotate(var(--pop-rot)); }
  30%  { transform: translate3d(calc(-0.9 * var(--pop-shake)), -2px, 0) rotate(calc(-1 * var(--pop-rot))); }
  40%  { transform: translate3d(calc(0.9 * var(--pop-shake)), -3px, 0) rotate(calc(0.8 * var(--pop-rot))); }
  55%  { transform: translate3d(calc(-0.6 * var(--pop-shake)), -2px, 0) rotate(calc(-0.6 * var(--pop-rot))); }
  70%  { transform: translate3d(calc(0.4 * var(--pop-shake)), -1px, 0) rotate(calc(0.4 * var(--pop-rot))); }
  100% { transform: translate3d(0,0,0) rotate(0deg); }
}

/* 2) caduta smooth: SOLO transform translate3d */
.char-fall-active{
  animation: charFall calc(var(--char-fall-duration) * 1ms) cubic-bezier(.22,.61,.36,1) forwards;
}

@keyframes charFall{
  from { transform: translate3d(0,0,0) rotate(0deg); opacity: 1; }
  to   { transform: translate3d(0,var(--y),0) rotate(var(--r)); opacity: 1; }
}

/* 3) risalita stesso percorso (reverse della caduta) */
.char-rise-active{
  animation: charRise calc(var(--char-rise-duration) * 1ms) cubic-bezier(.22,.61,.36,1) forwards;
}

@keyframes charRise{
  from { transform: translate3d(0,var(--y),0) rotate(var(--r)); opacity: 1; }
  to   { transform: translate3d(0,0,0) rotate(0deg); opacity: 1; }
}

/* accessibilità */
@media (prefers-reduced-motion: reduce){
  .char-pop, .char-fall-active, .char-rise-active{ animation: none !important; }
}
